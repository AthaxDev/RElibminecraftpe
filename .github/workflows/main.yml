name: Decompile libminecraftpe.so

on:
  push:
    paths:
      - 'libminecraftpe.so' # Trigger on changes to the SO file
  workflow_dispatch: # Allow manual trigger

jobs:
  decompile:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Locate the .so file
        # This step assumes the file is already in your repository or downloaded here
        # E.g., The file is at the root: libminecraftpe.so

      - name: Run Ghidra Decompilation in Docker
        id: decompile
        # Replace 'your-docker-image' with the image built in Step 1
        run: |
          # Build or pull your decompiler image here first if not already on Docker Hub
          # docker build -t decompiler-image .
          
          # Run the container, mounting the SO file and an output directory
          docker run \
            -v ${{ github.workspace }}/libminecraftpe.so:/input/libminecraftpe.so:ro \
            -v ${{ github.workspace }}/decompiled_output:/output \
            your-docker-image \
            /input/libminecraftpe.so /output

      - name: Upload Decompilation Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: libminecraftpe-decompilation
          path: decompiled_output/
          retention-days: 7
